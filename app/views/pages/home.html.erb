<div class="container"  style="padding-bottom: 20px">
  <!-- Barre de recherche -->
  <div class="px-3 mb-4 mt-4">
    <div class="d-flex w-100 gap-2">
      <!-- Search form - 90% -->
      <div class="flex-grow-1">
        <%= form_with url: books_path, method: :get, local: true, class: "d-flex align-items-center bg-white rounded-pill px-3 shadow-sm py-1" do |f| %>
        <i class="fas fa-search me-2" style="font-size: 14px; color: #751F1F; "></i>
          <%= f.text_field :query, placeholder: "Find your book here...", class: "form-control border-0 bg-white rounded-pill ", style: "font-size: 14px; color: #751F1F;", autofocus: false %>
        <% end %>
      </div>
      <!-- Icon link - 10% -->
      <div class="d-flex align-items-center justify-content-center" style="width: 42px;">
        <%= link_to quick_chat_path, data: {turbo_method: :post}, class: "text-decoration-none" do %>
          <i class="fa-solid fa-wand-magic-sparkles" style="font-size: 18px; color: #751F1F;"></i>
        <% end %>
      </div>
    </div>
  </div>
  <!-- Notre recommandation du jour
  <div class="row justify-content-center mb-5">
    <div class="carousel-inner">
      <% @book.each_with_index do |book, idx| %>
        <div class="carousel-item d-flex flex-column align-items-center">
          <img src="<%= book.cover_url %>" class="shadow rounded mb-2" alt="<%= book.title %>" style="width: 130px; height: 180px; object-fit: cover; ">
          <div class="mt-2 text-center">
            <h2 class="playfair-display" style="color:#751F1F; font-size: 16px;"><%= book.title %></h2>
            <div class="text-muted" style="font-size: 14px;;"><%= book.author %></div>
          </div>
        </div>
      <% end %>
    </div>
  </div>-->
  <!-- TEST -->
  <div id="carouselExampleDark" class="carousel slide mb-4" data-bs-ride="carousel">
    <div class="carousel-inner">
      <% @books.each_slice(3).with_index do |group, index| %>
        <div class="carousel-item <%= 'active' if index == 0 %>">
          <div class="d-flex justify-content-center position-relative" style="height: 220px; mb-0">
            <% group.each_with_index do |book, i| %>
              <% offset = (i - 1) * 60 %>
              <% z = i == 1 ? 3 : 1 %>
              <% scale = i == 1 ? 1 : 0.9 %>
              <img
              src="<%= book.cover_url %>"
              alt="<%= book.title %>"
              class="position-absolute shadow rounded"
              style="
                width: 130px;
                height: 180px;
                object-fit: cover;
                transform: scale(<%= scale %>);
                left: calc(50% + <%= offset %>px - 65px);
                z-index: <%= z %>;
              ">
              <% end %>
            </div>
            <div class="text-center">
              <h1><%= group[1].title %></h1>
              <p class="" style="font-size: 13px;"><%= group[1].author %></p>
            </div>
          </div>
        <% end %>
      </div>
      <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleDark" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      </button>
      <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleDark" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
      </button>
    </div>
    <!-- TEST -->
    <div class="mb-4" style="">
      <div class="d-flex align-items-center gap-4">
        <h2 class="mb-3" style="font-size: 20px; color: #751F1F">Recommandations</h2>
      </div>
      <div class="hide-scrollbar row flex-nowrap overflow-auto" style="gap: 4px;">
        <% @books.each do |book| %>
          <div class="col-auto gap: 2px;">
            <%= link_to book_path(book), class: "text-decoration-none" do %>
              <img src="<%= book.cover_url %>" class="rounded-3" style="width: 130px; height: 180px; object-fit: cover; margin-bottom: 1rem; box-shadow: 6px 6px 10px rgba(0, 0, 0, 0.1);" alt="<%= book.title %>">
              <h6 style="margin-bottom: 2px; white-space: nowrap; max-width: 120px; overflow: hidden; text-overflow: ellipsis;">
                <%= truncate(book.title, length: 22) %>
              </h6>
              <p class="" style="font-size: 12px; margin-bottom: 0;"><%= book.author %></p>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
    <div class="" style="padding-bottom: 70px">
      <h2 class="mb-3 fw-bold" style="font-size: 20px; color: #751F1F font-">Last book</h2>
      <div class="hide-scrollbar row flex-nowrap overflow-auto" style="gap: 4px;">
        <% @last.each do |book| %>
          <div class="col-auto gap: 2px;">
            <%= link_to book_path(book), class: "text-decoration-none" do %>
              <img src="<%= book.cover_url %>" style="width: 130px; height: 180px; object-fit: cover; margin-bottom: 1rem; " alt="<%= book.title %>">
              <h6 style="margin-bottom: 2px; white-space: nowrap; max-width: 120px; overflow: hidden; text-overflow: ellipsis;">
                <%= truncate(book.title, length: 22) %>
              </h6>
              <p class="text-muted" style="font-size: 11px; margin-bottom: 0;"><%= book.author %></p>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
  <div class="tab-bar d-flex bg-white justify-content-between position-fixed w-100 start-50 translate-middle-x px-5" style="bottom: 0px; height: 56px; z-index: 999; box-shadow: 0px -4px 4px rgba(0, 0, 0, 0.05)">
    <%= link_to bookclubs_user_path(current_user), class: "text-center text-decoration-none d-flex flex-column align-items-center justify-content-center" do %>
      <i class="fas fa-book" style="font-size: 20px; color: #751F1F"></i>
    <% end %>
    <%= link_to lists_user_path(current_user), class: "text-center text-dark text-decoration-none d-flex flex-column align-items-center justify-content-center" do %>
      <i class="fa-solid fa-list" style="font-size: 20px; color: #751F1F"></i>
    <% end %>
    <%= link_to books_path, class: "text-center text-dark text-decoration-none d-flex flex-column align-items-center justify-content-center" do %>
      <i class="fa-solid fa-feather" style="font-size: 20px; color: #751F1F"></i>
    <% end %>
    <%= link_to dashboard_path, class: "text-center text-dark text-decoration-none d-flex flex-column align-items-center justify-content-center" do %>
      <i class="fas fa-user" style="font-size: 20px; color: #751F1F"></i>
    <% end %>
  </div>
</div>
<!--<div class="tab-bar d-flex justify-content-around align-items-center bg-light rounded-pill px-3 shadow-sm position-fixed w-75 start-50 translate-middle-x" style="bottom: 16px; height: 56px; z-index: 999;">
<%= link_to bookclubs_path, class: "text-center text-dark text-decoration-none d-flex flex-column align-items-center justify-content-center" do %>
  <i class="fas fa-book" style="font-size: 16px; line-height: 1.5; color: #751F1F"></i>
  <h3 style="font-size: 10px; line-height: 2;">Bookclub</h3>
<% end %>
<%= link_to quick_chat_path, data: { turbo_method: :post }, class: "text-center text-dark text-decoration-none d-flex flex-column align-items-center justify-content-center" do %>
  <i class="fas fa-robot" style="font-size: 16px; line-height: 1.5; color: #751F1F"></i>
  <h3 style="font-size: 10px; line-height: 2;">Ask Margi</h3>
<% end %>
<%= link_to books_path, class: "text-center text-dark text-decoration-none d-flex flex-column align-items-center justify-content-center" do %>
  <i class="fas fa-pen" style="font-size: 16px; line-height: 1.5; color: #751F1F"></i>
  <h3 style="font-size: 10px; line-height: 2;">Review</h3>
<% end %>
<%= link_to dashboard_path, class: "text-center text-dark text-decoration-none d-flex flex-column align-items-center justify-content-center" do %>
  <i class="fas fa-user" style="font-size: 16px; line-height: 1.5; color: #751F1F"></i>
  <h3 style="font-size: 10px; line-height: 2; ">Profil</h3>
<% end %>
</div>
